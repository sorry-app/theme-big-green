<!DOCTYPE html>
<!-- Define The Angular App -->
<html ng-app="status-page">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <!-- We don't want these pages indexed by Google until BETA. -->
        <meta name="robots" content="noindex, nofollow" />

        <!-- Dynamicly set the title using the helper methoe. -->
        <title>{{page.name}}</title>

        <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

        <!-- Include CSS Assets. -->
        <link rel="stylesheet" href="dist/stylesheets/status-page.css" />
    </head>
    <body ng-controller="PageCtrl" data-pusher-key="8d89d29aaf9f27452fc5" data-pusher-channel="status-page.sorryapp.com">
        <!-- Header Block For Large Status Message -->
        <!-- Use the 'sorry' method to set the green/orange state. -->
        <header class="sorry-{{sorry()}}">
            <!-- Output the name of this status page. -->
            <!-- Has to be lower in DOM than carousel to avoid breaking verticle align. -->
            <h1>{{page.name}}</h1>

            <!-- Switch the status message based on the Sorry state. -->
            <!-- Must be first element inside header to ensure vertical align set propoperly. -->
            <div class="current-status" ng-switch="sorry()">
                <!-- We have nothing to be sorry about, so all is well. -->
                <div ng-switch-when="false">
                    <div class="apology">
                        <h2 id="status">All Is Well</h2>
                    </div>
                </div>
                <!-- We have some apologies. -->
                <div ng-switch-when="true">
                    <!-- Loop over the collection of current apologies. -->
                    <div active="apology.active" ng-repeat="apology in current_apologies() | orderBy:'created_at':true" class="apology"  id="apology_{{apology.id}}">
                        <!-- Output the title for the apology. -->
                        <h2>
                            <!-- Output the date the apology was created, with live timer increment. -->
                            <span>Started <time class="live" data-stamp="{{apology.created_at}}"></time></span>

                            <!-- Output the apology description. -->
                            {{apology.description}}
                        </h2>

                        <!-- Loop over any updates we have for the apology, only displaying the last. -->
                        <h3 ng-repeat="update in apology.updates | orderBy:'created_at':true | limitTo:1">
                            <span>
                                Last Updated 
                                <!-- Output the datetime for the update, with live timer incrememnt. -->
                                <time class="live dt" data-stamp="{{update.created_at}}"></time>
                            </span>
                            <!-- OUtput the text content for the update. -->
                            {{update.content}}
                        </h3>

                        <!-- If we have no updates to display, show a message to this effect. -->
                        <h3 class="no-updates" ng-hide="apology.updates.length">We have no further updates on this yet.</h3>
                    </div>
                </div>
            </div>            

            <a href="#previous-apologies" ng-show="previous_apologies().length > 0" class="see-below">&#65088;</a>
        </header>

        <!-- Block For Previously Solved. -->
        <section id="previous-apologies" class="previous-apologies" ng-show="previous_apologies().length > 0">
            <!-- Loop over the collection of previous apologies, order date descending. -->
            <article ng-repeat="apology in previous_apologies() | orderBy:'closed_at':true" class="apology" id="apology_{apology.id}">
                <h4>
                    <!-- Output the date for the apology, with live timer increment. -->
                    <span>Started <time>{{apology.created_at | date:'short'}}</time></span>
                    <!-- Output the description of the apology. -->
                    {{apology.description}}
                </h4>

                <ul class="updates unstyled">
                    <!-- Loop over the updates, showing all, in date order. -->
                    <li ng-repeat="update in apology.updates | orderBy:'created_at'">
                        <!-- Output the date for the update. -->
                        <time class="dt">{{update.created_at | date:'short'}}</time>
                        <!-- Output the text content of the update. -->
                        <span class="dd">{{update.content}}</span>
                    </li>
                </ul>
            </article>
        </section>

        <!-- Include the required assets. -->
        <!-- Frameworks. -->
        <script src="dist/javascripts/status-page.js"></script>
    </body>
</html>